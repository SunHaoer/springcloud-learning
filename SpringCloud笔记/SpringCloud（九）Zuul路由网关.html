<html>
<head>
  <title>SpringCloud（九）Zuul路由网关</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600986 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="793"/>
<h1>SpringCloud（九）Zuul路由网关</h1>

<div>
<span><div><h2>概述</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Zuul包含了对请求的路由和过滤两个主要的功能，其中路由的功能是负责将外部请求转发到具体的微服务实例上，是实现外部访问统一入口的基础而过滤功能是负责对请求的处理过程进行干预，是实现请求校验，服务聚合等功能的基础，Zuul和Eureka进行整合，将Zuul自身注册近Eureka服务治理的应用，同时从Eureka中获取其他微服务的消息，也及时以后的访问服务都是通过Zuul跳转后获得，</span> <span style="font-weight: bold;-en-paragraph:true;">注意的是Zuul服务最终还是会注册近Eureka中</span></div><h2>路由基本配置</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">新建项目microservicecloud-zuul-gateway-9527，添加依赖如下</span></div><h3>pom.xml文件</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div>  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div>  &lt;parent&gt;</div><div>    &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;microservicecloud&lt;/artifactId&gt;</div><div>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</div><div>  &lt;/parent&gt;</div><div>  &lt;artifactId&gt;microservicecloud-zuul-gateway-9527&lt;/artifactId&gt;&lt;dependencies&gt;</div><div>                &lt;!-- zuul路由网关 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-zuul&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- actuator监控 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- hystrix容错 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- 日常标配 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div>                        &lt;version&gt;${project.version}&lt;/version&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- 热部署插件 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>        &lt;/dependencies&gt;</div><div>&lt;/project&gt;</div></div><h3><br/></h3><h3>application.yml文件</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 9527</div><div>spring:</div><div>  application:    </div><div>  name: microservicecloud-zuul-gateway</div><div>eureka:</div><div>  client:</div><div>    service-url:</div><div>      defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka  </div><div>  instance:    </div><div>    instance-id: gateway-9527.com    </div><div>    prefer-ip-address: true</div><div>zuul:</div><div>  #ignored-services: microservicecloud-dept  </div><div>  prefix: /luo  </div><div>  ignored-services: &quot;*&quot;</div><div>info:</div><div>  app.name: luo-microcloud</div><div>  company.name: www.luo.com</div><div>  build.artifactId: $project.artifactId$</div><div>  build.version: $project.version$复制代码</div><div><br/></div><div><br/></div></div><h3>修改host文件</h3><div>127.0.0.1 <a href="http://myzuul.com/">myzuul.com</a></div><div>复制代码</div><h3>主启动类Zuul_9527_StartSpringCloudApp</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@SpringBootApplication</div><div>@EnableZuulProxy</div><div>public class Zuul_9527_StartSpringCloudApp {</div><div>        public static void main(String[] args) {</div><div>                SpringApplication.run(Zuul_9527_StartSpringCloudApp.class, args);</div><div>        }</div><div>}</div></div><div><br/></div><h3>启动</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">三个集群，一个服务提供类microservicecloud-provider-dept-8001，一个路由</span></div><h3>测试</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">不使用路由：<a href="http://localhosat:8001/dept/get/2">http://localhosat:8001/dept/get/2</a></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">使用路由：<a href="http://myzuul.com:9527/microservicecloud-dept/dept/get/2">http://myzuul.com:9527/microservicecloud-dept/dept/get/2</a></span></div><h2>Zuul路由访问映射</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在前面的测试中我们可以使用<a href="http://myzuul.com:9527/microservicecloud-dept/dept/get/2">http://myzuul.com:9527/microservicecloud-dept/dept/get/2</a>访问我们的接口，这样就暴露我们的微服务名称，需要做安全加固，就用到了路由访问映射，修改路由项目的yml文件,添加 mydept.path: /mydept/**</span></div><div>zuul:</div><div>#ignored-services: microservicecloud-dept #忽略真实地址，只让虚拟地址访问 prefix: /luo #访问地址前缀 ignored-services: &quot;*&quot;#忽略真实地址，只让虚拟地址访问 routes:</div><div>mydept.serviceId: microservicecloud-dept ##真实地址</div><div>mydept.path: /mydept/** # 虚拟地址复制代码</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;-en-paragraph:true;">访问连接：<a href="http://lyzuul.com:9527/luo/mydept/dept/get/1">http://lyzuul.com:9527/luo/mydept/dept/get/1</a></span></div><div><br/></div></div></span>
</div></body></html> 