<html>
<head>
  <title>SpringCloud（八）Hystrix断路器</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600986 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="791"/>
<h1>SpringCloud（八）Hystrix断路器</h1>

<div>
<span><div><h1>Hystrix断路器</h1><h2>概述</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Hystrix是一个用于处理分布式系统的</span><span style="font-weight: bold;-en-paragraph:true;">延迟</span><span style="-en-paragraph:true;">和</span><span style="font-weight: bold;-en-paragraph:true;">容错</span><span style="-en-paragraph:true;">的开源库，在分布式系统中，许多的依赖不可避免的会调用失败，比如超时，异常等，Hystrix能够保证在一个依赖出问题的情况下， **不会导致整体服务的失败，避免级联故障，以提高分布式系统的弹性。**断路器本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故障监控（类似熔断保险丝），</span> <span style="font-weight: bold;-en-paragraph:true;">向调用方法返回一个预期的，可处理的备选响应（FallBack），而不是长时间的等待或者抛出调用方法异常无法处理的异常</span><span style="-en-paragraph:true;">，这样就保证服务调用方的线程不会被长时间，不必要的占用，从而避免了故障在分布式系统中的蔓延。</span></div><h2>服务熔断</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">熔断机制是应对雪崩效应的一种微服务链路保护机制，当扇出链路的某一个微服务不可用或者响应时间太长，会进行服务的降级，</span> <span style="font-weight: bold;-en-paragraph:true;">进而熔断该节点微服务的调用，快速返回“错误”的响应信息</span><span style="-en-paragraph:true;">，当检测到该节点微服务调用响应正常后恢复调用链路，在SpringCloud框架中熔断机制使用Hystrix实现，Hystrix会监控微服务调用情况，当失败达到一定阈值。就会启动熔断机制，熔断机制的注解是</span> <span style="font-weight: bold;-en-paragraph:true;">@HystrixCommand</span></div><h2>Hystrix实操</h2><h3>参照microservicecloud-provider-dept-8001建立microservicecloud-provider-dept-hystrix-8001项目</h3><h3>pom.xml文件</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;dependency&gt;</div><div>  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>  &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;&lt;/dependency&gt;复制代码</div><div>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div>  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div>  &lt;parent&gt;</div><div>    &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;microservicecloud&lt;/artifactId&gt;</div><div>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</div><div>  &lt;/parent&gt;</div><div>  &lt;artifactId&gt;microservicecloud-provider-dept-hystrix-8001&lt;/artifactId&gt;&lt;dependencies&gt;</div><div>                &lt;!-- hystrix --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- 引入自己定义的api通用包，可以使用Dept部门Entity --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div>                        &lt;version&gt;${project.version}&lt;/version&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- actuator监控信息完善 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- 将微服务provider侧注册进eureka --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;junit&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;druid&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- 修改后立即生效，热部署 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>        &lt;/dependencies&gt;</div><div>&lt;/project&gt;</div></div><h3>application.yml文件</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>eureka:</div><div>  client: #客户端注册进eureka服务列表内</div><div>    service-url:</div><div>      #defaultZone: http://localhost:7001/eureka</div><div>      defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/      </div><div>  instance:</div><div>    instance-id: microservicecloud-dept8001-hystrix #自定义服务名称信息</div><div>    prefer-ip-address: true     #访问路径可以显示IP地址</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 8001</div><div>  </div><div>mybatis:</div><div>  config-location: classpath:mybatis/mybatis.cfg.xml        # mybatis配置文件所在路径</div><div>  type-aliases-package: com.luo.springcloud.entities        # 所有Entity别名类所在包</div><div>  mapper-locations:</div><div>  - classpath:mybatis/mapper/**/*.xml                       # mapper映射文件</div><div>    </div><div>spring:</div><div>   application:</div><div>    name: microservicecloud-dept</div><div>   datasource:</div><div>    type: com.alibaba.druid.pool.DruidDataSource            # 当前数据源操作类型</div><div>    driver-class-name: org.gjt.mm.mysql.Driver              # mysql驱动包</div><div>    url: jdbc:mysql://localhost:3306/cloudDB01              # 数据库名称</div><div>    username: root</div><div>    password: 1234</div><div>    dbcp2:</div><div>      min-idle: 5                                           # 数据库连接池的最小维持连接数</div><div>      initial-size: 5                                       # 初始化连接数</div><div>      max-total: 5                                          # 最大连接数</div><div>      max-wait-millis: 200                                  # 等待连接获取的最大超时时间</div><div>      </div><div>eureka:</div><div>  client: #客户端注册进eureka服务列表内</div><div>    service-url:</div><div>      #defaultZone: http://localhost:7001/eureka</div><div>      defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/      </div><div>  instance:</div><div>    instance-id: microservicecloud-dept8001-hystrix #自定义服务名称信息</div><div>    prefer-ip-address: true     #访问路径可以显示IP地址</div><div>    </div><div>info:</div><div>  app.name: luokangyuan-microservicecloud</div><div>  company.name: www.luokangyuan.com</div><div>  build.artifactId: $project.artifactId$</div><div>  build.version: $project.version$</div></div><h3><br/></h3><h3>修改DeptController</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Hystrix的作用就是当调用服务出现异常时如何解决，模拟根据id查部门信息，查到null，人为抛出运行时异常，让Hystrix处理这种情况。</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@RequestMapping(value=&quot;dept/get/{id}&quot;,method=RequestMethod.GET)</div><div>@HystrixCommand(fallbackMethod = &quot;processHystrix_GET&quot;)</div><div>public Dept get(@PathVariable(&quot;id&quot;) Long id){</div><div>  Dept dept = service.get(id);</div><div>  if(null == dept){</div><div>    throw new RuntimeException(&quot;该ID:&quot;+id+&quot;没有对应的部门信息&quot;);</div><div>  }</div><div>  return dept;</div><div>}</div><div>public Dept processHystrix_GET(@PathVariable(&quot;id&quot;) Long id){</div><div>  return new Dept().setDeptno(id)</div><div>    .setDname(&quot;该ID：&quot;+id+&quot;没有对应的信息，null--@HystrixCommand&quot;)</div><div>    .setDb_source(&quot;no this database in Mysql&quot;);</div><div>}</div></div><div><br/></div><h3>修改主启动类添加Hystrix支持</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@SpringBootApplication@EnableEurekaClient // 本服务启动后会注册到Eureka服务注册中心@EnableDiscoveryClient // 服务发现@EnableCircuitBreaker //对Hystrix熔断机制的支持public class DeptProvider8001_Hystrix_App {</div><div>        public static void main(String[] args) {</div><div>                SpringApplication.run(DeptProvider8001_Hystrix_App.class, args);</div><div>        }</div><div>}</div><div><br/></div><div><br/></div></div><div><br/></div><h3>测试熔断机制</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">启动三个Eureka集群，启动服务主启动类DeptProvider8001_Hystrix_App，客户端启动microservicecloud-consumer-dept-80，页面访问<a href="http://localhost/consumer/dept/get/112">http://localhost/consumer/dept/get/112</a></span></div><h2>服务降级</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">服务降级处理是在客户端完成的，与服务端没有关系，在前面的服务熔断中，我们发现每一个业务方法都要写一个processHystrix_方法，这样就造成了很大耦合，根据Spring的学习，我们可将processHystrix_改写一个异常通知。</span></div><h3>修改microservicecloud-api工程</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">根据已有的DeptClientService接口，新建一个实现了FallbackFactory接口的类DeptClientServiceFallbackFactory</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.luo.springcloud.service;</div><div>import java.util.List;</div><div>import org.springframework.stereotype.Component;</div><div>import com.luo.springcloud.entities.Dept;</div><div>import feign.hystrix.FallbackFactory;</div><div>@Component</div><div>public class DeptClientServiceFallbackFactory implements FallbackFactory&lt;DeptClientService&gt;{</div><div>        @Override</div><div>        public DeptClientService create(Throwable arg0) {</div><div>                return new DeptClientService() {</div><div>                        </div><div>                        @Override</div><div>                        public List&lt;Dept&gt; list() {</div><div>                                return null;</div><div>                        }</div><div>                        </div><div>                        @Override</div><div>                        public Dept get(long id) {</div><div>                                return new Dept().setDeptno(id)</div><div>                                                .setDname(&quot;该ID：&quot;+id+&quot;没有对应的信息，Consumer客户端提供的降级信息，此服务暂停使用&quot;)</div><div>                                                .setDb_source(&quot;no this database in Mysql&quot;);</div><div>                        }</div><div>                        </div><div>                        @Override</div><div>                        public boolean add(Dept dept) {</div><div>                                return false;</div><div>                        }</div><div>                };</div><div>        }</div><div>}</div></div><div><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;-en-paragraph:true;">注意：不要忘记新类上添加@Component注解</span></div><h3>修改microservicecloud-api</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在DeptClientService接口在注解@FeignClient(value = &quot;MICROSERVICECLOUD-DEPT&quot;)添加fallbackFactory属性值</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@FeignClient(value = &quot;MICROSERVICECLOUD-DEPT&quot;,fallbackFactory = DeptClientServiceFallbackFactory.class)</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@FeignClient(value = &quot;MICROSERVICECLOUD-DEPT&quot;,fallbackFactory = DeptClientServiceFallbackFactory.class)</div><div>public interface DeptClientService {</div><div>        @RequestMapping(value = &quot;/dept/get/{id}&quot;,method = RequestMethod.GET)</div><div>        public Dept get(@PathVariable(&quot;id&quot;) long id);</div><div>        </div><div>        @RequestMapping(value = &quot;/dept/list&quot;,method = RequestMethod.GET)</div><div>        public List&lt;Dept&gt; list();</div><div>        </div><div>        @RequestMapping(value = &quot;/dept/add&quot;, method = RequestMethod.POST)</div><div>        public boolean add(Dept dept);</div><div>}</div></div><div><br/></div><h3>修改microservicecloud-consumer-dept-feign的Application.yml文件</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:  port: 80</div><div>  </div><div>feign:</div><div>  hystrix:</div><div>    enabled: trueeureka:  client:    register-with-eureka: false    service-url:</div><div>      defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</div><div><br/></div><div><br/></div></div><div><br/></div><h3>测试服务降级</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">启动三个Eureka集群，microservicecloud-provider-dept-8001启动，microservicecloud-consumer-dept-feign启动，正常访问<a href="http://localhost/consumer/dept/get/1">http://localhost/consumer/dept/get/1</a>测试，故意关停microservicecloud-provider-dept-8001，客户端自己调用提示</span></div><h2>服务监控Hystrix Dashboard</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Hystrix还提供了准实时的调用监控Hystrix Dashboard，Hystx会持续的记录所有通过Hystrix发起的请求的执行信息，并以统计报表的图形的形式展示给用户，包括每秒执行多少次请求多少成功多少失败等，对监控内容转换为可视化界面。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;-en-paragraph:true;">新建microservicecloud-consumer-hystrix-dashboard监控的一个微服务工程</span></div><h2>POM.xml文件</h2><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div>  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div>  &lt;parent&gt;</div><div>    &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;microservicecloud&lt;/artifactId&gt;</div><div>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</div><div>  &lt;/parent&gt;</div><div>  &lt;artifactId&gt;microservicecloud-consumer-hystrix-dashboard&lt;/artifactId&gt;&lt;dependencies&gt;</div><div>                &lt;!-- 自己定义的api --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div>                        &lt;version&gt;${project.version}&lt;/version&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- 修改后立即生效，热部署 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- Ribbon相关 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-ribbon&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- feign相关 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- hystrix和 hystrix-dashboard相关 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-hystrix-dashboard&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>        &lt;/dependencies&gt;</div><div>&lt;/project&gt;</div></div><h2><br/></h2><h2>application.yml文件</h2><div>server: port: 9001复制代码</div><h2>主启动类DeptConsumer_DashBoard_App</h2><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@SpringBootApplication</div><div>@EnableHystrixDashboard</div><div>public class DeptConsumer_DashBoard_App {</div><div>        public static void main(String[] args) {</div><div>                SpringApplication.run(DeptConsumer_DashBoard_App.class, args);</div><div>        }</div><div>}</div></div><h2><br/></h2><h2>微服务提供者添加监控依赖配置</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">所有的Provider微服务提供类（8001,8002,8003）都需要监控依赖配置，也就是pom文件添加如下依赖</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;!-- actuator监控信息完善 --&gt;&lt;dependency&gt;</div><div>  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>  &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div>&lt;/dependency&gt;</div></div><h2><br/></h2><h2>监控页面测试</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;-en-paragraph:true;">启动microservicecloud-consumer-hystrix-dashboard，访问<a href="http://localhost:9001/hystrix">http://localhost:9001/hystrix</a>,出现豪猪页面</span></div><h2>全部测试</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;-en-paragraph:true;">启动3个Eureka集群，启动microservicecloud-provider-dept-hystrix-8001</span><span style="-en-paragraph:true;">，启动了microservicecloud-consumer-hystrix-dashboard用来监控8001服务提供者，访问<a href="http://localhost:8001/hystrix.stream">http://localhost:8001/hystrix.stream</a></span></div><h3>观察监控窗口</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">访问<a href="http://localhost:9001/hystrix">http://localhost:9001/hystrix</a>，填写监控地址<a href="http://localhost:8001/hystrix.stream">http://localhost:8001/hystrix.stream</a>,时间2000，title:demo01,点击按钮</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">实心圆：两种含义，它通过颜色的变化代表了实例的健康程度，健康色是从绿色&lt;黄色&lt;橙色&lt;红色递减，该实心圆除了颜色的变化之外，他的大小也会根据实例的请求流量发生变化，流量越大该实心圆就越大，所以通过实心圆的展示就可以在大量实例中快速的发现</span> <span style="font-weight: bold;-en-paragraph:true;">故障实例和高压力测试</span><span style="-en-paragraph:true;">。</span></div><div><br/></div></div></span>
</div></body></html> 