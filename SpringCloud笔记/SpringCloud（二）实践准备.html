<html>
<head>
  <title>SpringCloud（二）实践准备</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600986 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="779"/>
<h1>SpringCloud（二）实践准备</h1>

<div>
<span><div><h2>项目技术版本</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">SpringCloud版本：Dalston.SR1，SpringBoot版本：1.5.9</span></div><h2>项目说明</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">项目是使用SpringCloud将四个工程进行整合，microservicecloud整体父工程Project，microservicecloud-api公共子模块Module，microservicecloud-provider-dept-8001部门微服务提供者Module，microservicecloud-consumer-dept-80部门微服务消费者Module。</span></div><h2>1.父类项目创建</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在逻辑视图中选择new-Maven Project-勾上创建简单项目-选择pom方式</span></div><h3>pom.xml文件</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div>        xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div>        &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div>        &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;microservicecloud&lt;/artifactId&gt;</div><div>        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</div><div>        &lt;packaging&gt;pom&lt;/packaging&gt;</div><div>        &lt;properties&gt;</div><div>                &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</div><div>                &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</div><div>                &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</div><div>                &lt;junit.version&gt;4.12&lt;/junit.version&gt;</div><div>                &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt;</div><div>                &lt;lombok.version&gt;1.16.18&lt;/lombok.version&gt;</div><div>        &lt;/properties&gt;</div><div>        &lt;dependencyManagement&gt;</div><div>                &lt;dependencies&gt;</div><div>                        &lt;dependency&gt;</div><div>                                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</div><div>                                &lt;version&gt;Dalston.SR1&lt;/version&gt;</div><div>                                &lt;type&gt;pom&lt;/type&gt;</div><div>                                &lt;scope&gt;import&lt;/scope&gt;</div><div>                        &lt;/dependency&gt;</div><div>                        &lt;dependency&gt;</div><div>                                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                                &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;</div><div>                                &lt;version&gt;1.5.9.RELEASE&lt;/version&gt;</div><div>                                &lt;type&gt;pom&lt;/type&gt;</div><div>                                &lt;scope&gt;import&lt;/scope&gt;</div><div>                        &lt;/dependency&gt;</div><div>                        &lt;dependency&gt;</div><div>                                &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div>                                &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</div><div>                                &lt;version&gt;5.0.4&lt;/version&gt;</div><div>                        &lt;/dependency&gt;</div><div>                        &lt;dependency&gt;</div><div>                                &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div>                                &lt;artifactId&gt;druid&lt;/artifactId&gt;</div><div>                                &lt;version&gt;1.0.31&lt;/version&gt;</div><div>                        &lt;/dependency&gt;</div><div>                        &lt;dependency&gt;</div><div>                                &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</div><div>                                &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</div><div>                                &lt;version&gt;1.3.0&lt;/version&gt;</div><div>                        &lt;/dependency&gt;</div><div>                        &lt;dependency&gt;</div><div>                                &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</div><div>                                &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</div><div>                                &lt;version&gt;1.2.3&lt;/version&gt;</div><div>                        &lt;/dependency&gt;</div><div>                        &lt;dependency&gt;</div><div>                                &lt;groupId&gt;junit&lt;/groupId&gt;</div><div>                                &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div>                                &lt;version&gt;${junit.version}&lt;/version&gt;</div><div>                                &lt;scope&gt;test&lt;/scope&gt;</div><div>                        &lt;/dependency&gt;</div><div>                        &lt;dependency&gt;</div><div>                                &lt;groupId&gt;log4j&lt;/groupId&gt;</div><div>                                &lt;artifactId&gt;log4j&lt;/artifactId&gt;</div><div>                                &lt;version&gt;${log4j.version}&lt;/version&gt;</div><div>                        &lt;/dependency&gt;</div><div>                &lt;/dependencies&gt;</div><div>        &lt;/dependencyManagement&gt;</div><div>&lt;/project&gt;</div></div><div><br/></div><div><br/></div><div>复制代码</div><h2>2.公共组件项目创建</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在父项目上创建microservicecloud-api项目，注意是在microservicecloud上new一个maven module，packaging选择jar</span></div><h3>POM.xml文件</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div>  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div>  &lt;parent&gt;</div><div>    &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;microservicecloud&lt;/artifactId&gt;</div><div>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</div><div>  &lt;/parent&gt;</div><div>  &lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div><span>  </span>&lt;dependencies&gt;</div><div><span>  <span>    </span></span>&lt;!-- 当前Module需要用到的jar包，按自己需求添加，如果父类已经包含了，可以不用写版本号 --&gt;</div><div><span>    </span><span>  </span>&lt;dependency&gt;</div><div>      <span>    </span>&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</div><div>          &lt;artifactId&gt;lombok&lt;/artifactId&gt;</div><div>      &lt;/dependency&gt;</div><div>      &lt;dependency&gt;</div><div>        <span>  </span>&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>          &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;</div><div>      &lt;/dependency&gt;</div><div>  &lt;/dependencies&gt;</div><div>&lt;/project&gt;</div></div><h3>Dept实体类</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>public class Dept implements Serializable{</div><div>        private Long deptno; // 主键</div><div>        private String dname; // 部门名称、</div><div>        private String db_source; // 来自那个数据库，因为微服务可以一个服务对应一个数据库，同一个信息被存储到不同的数据库</div><div>        </div><div>        public Dept() {</div><div>                super();</div><div>        }</div><div>        public Dept(Long deptno, String dname, String db_source) {</div><div>                super();</div><div>                this.deptno = deptno;</div><div>                this.dname = dname;</div><div>                this.db_source = db_source;</div><div>        }</div><div>        public Long getDeptno() {</div><div>                return deptno;</div><div>        }</div><div>        public void setDeptno(Long deptno) {</div><div>                this.deptno = deptno;</div><div>        }</div><div>        public String getDname() {</div><div>                return dname;</div><div>        }</div><div>        public void setDname(String dname) {</div><div>                this.dname = dname;</div><div>        }</div><div>        public String getDb_source() {</div><div>                return db_source;</div><div>        }</div><div>        public void setDb_source(String db_source) {</div><div>                this.db_source = db_source;</div><div>        }</div><div>        @Override</div><div>        public String toString() {</div><div>                return &quot;Dept [deptno=&quot; + deptno + &quot;, dname=&quot; + dname + &quot;, db_source=&quot; + db_source + &quot;]&quot;;</div><div>        }</div><div>}</div><div><br/></div></div><div><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">当我们每次都需要创建一个实体类的getter，setter，toString和构造器等方法时，如果增加一个字段就要重新生成方法，为了简化这种重复的操作，我们在前面的pom中引入了lombok，同样的实体类，使用方法如下</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@SuppressWarnings(&quot;serial&quot;)</div><div>@AllArgsConstructor@NoArgsConstructor@Data@Accessors(chain=true)</div><div>public class Dept implements Serializable{</div><div>        private Long deptno; // 主键</div><div>        private String dname; // 部门名称</div><div>    <span>    </span>// 来自那个数据库，因为微服务可以一个服务对应一个数据库，同一个信息被存储到不同的数据库</div><div>        private String db_source;</div><div>}</div></div><h4>lombok安装方法</h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">拷贝lombok-1.16.18.jar到Eclipse目录下，执行java -jar D:\javasoft\eclipse-jee-neon-3-win32-x86_64\eclipse\ombok-1.16.18.jar，然后，弹框中选择Eclipse安装目录，选择install即可。</span></div><h4>lombok注解使用</h4><div>@Data ：注解在类上；提供类所有属性的 getting 和 setting 方法，此外还提供了equals、canEqual</div><div>@Setter：注解在属性上；为属性提供 setting 方法</div><div>@Getter：注解在属性上；为属性提供 getting 方法</div><div>@Log4j ：注解在类上；为类提供一个 属性名为log 的 log4j 日志对象</div><div>@NoArgsConstructor：注解在类上；为类提供一个无参的构造方法</div><div>@AllArgsConstructor：注解在类上；为类提供一个全参的构造方法</div><div>@Accessors(chain=true)：可以使用链式写法</div><div><br/></div><h4>lombok测试</h4><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@SuppressWarnings(&quot;serial&quot;)</div><div>@AllArgsConstructor@NoArgsConstructor@Data@Accessors(chain=true)</div><div>public class Dept implements Serializable{</div><div>        </div><div>        private Long deptno; // 主键</div><div>        private String dname; // 部门名称、</div><div>        private String db_source; // 来自那个数据库，因为微服务可以一个服务对应一个数据库，同一个信息被存储到不同的数据库</div><div>        public static void main(String[] args) {</div><div>                Dept dept = new Dept();</div><div>                dept.setDeptno(12L).setDname(&quot;开发部&quot;).setDb_source(&quot;DB01&quot;);</div><div>        }</div><div>}</div></div><div><br/></div><h4>注意内容</h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">实体类必须实现Serializable接口</span></div><h3>打包使用</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">公共组件模块写好后可以点击run as 选择maven clean ，然后在选择maven install。其他模块引用的方法如下</span></div><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;&lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</div></div><br/></div><div>复制代码</div><h2>3.部门微服务提供者</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">首先现在父类项目上new一个maven module,microservicecloud-provider-dept-8001修改pom.xml文件</span></div><h3>pom.xml文件</h3><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div>        xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div>        &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div>        &lt;parent&gt;</div><div>                &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>                &lt;artifactId&gt;microservicecloud&lt;/artifactId&gt;</div><div>                &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</div><div>        &lt;/parent&gt;</div><div>        &lt;artifactId&gt;microservicecloud-provider-dept-8001&lt;/artifactId&gt;</div><div>        &lt;dependencies&gt;</div><div>                &lt;!-- 引入自己定义的api通用包，可以使用Dept部门Entity --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div>                        &lt;version&gt;${project.version}&lt;/version&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- actuator监控信息完善 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- 将微服务provider侧注册进eureka --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;junit&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;druid&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- 修改后立即生效，热部署 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>        &lt;/dependencies&gt;</div><div>&lt;/project&gt;</div></div><br/></div><h3>application.yml文件</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 8001</div><div>  </div><div>mybatis:</div><div>  config-location: classpath:mybatis/mybatis.cfg.xml        # mybatis配置文件所在路径</div><div>  type-aliases-package: com.luo.springcloud.entities        # 所有Entity别名类所在包</div><div>  mapper-locations:</div><div>  - classpath:mybatis/mapper/**/*.xml                       # mapper映射文件</div><div>    </div><div>spring:</div><div>   application:</div><div>    name: microservicecloud-dept</div><div>   datasource:</div><div>    type: com.alibaba.druid.pool.DruidDataSource            # 当前数据源操作类型</div><div>    driver-class-name: org.gjt.mm.mysql.Driver              # mysql驱动包</div><div>    url: jdbc:mysql://localhost:3306/cloudDB01              # 数据库名称</div><div>    username: root</div><div>    password: 1234</div><div>    dbcp2:</div><div>      min-idle: 5                                           # 数据库连接池的最小维持连接数</div><div>      initial-size: 5                                       # 初始化连接数</div><div>      max-total: 5                                          # 最大连接数</div><div>      max-wait-millis: 200                                  # 等待连接获取的最大超时时间</div><div>      </div><div>eureka:</div><div>  client: #客户端注册进eureka服务列表内</div><div>    service-url:</div><div>      defaultZone: http://localhost:7001/eureka</div></div><h3>mybatis下mybatis.cfg.xml</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE configuration</div><div>  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</div><div>  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</div><div>&lt;configuration&gt;</div><div>        &lt;settings&gt;</div><div>                &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot; /&gt;&lt;!-- 二级缓存开启 --&gt;</div><div>        &lt;/settings&gt;</div><div>&lt;/configuration&gt;</div><div><br/></div><div><br/></div></div><h3>SQL语句</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>DROP DATABASE IF EXISTS cloudDB01 ;</div><div>CREATE DATABASE cloudDB01 CHARACTER SET UTF8 ;</div><div>USE cloudDB01 ;</div><div>CREATE TABLE dept (</div><div>  deptno BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,</div><div>  dname VARCHAR (60),</div><div>  db_source VARCHAR (60)</div><div>) ;</div><div>INSERT INTO dept(dname,db_source) VALUES('开发部',DATABASE());</div><div>INSERT INTO dept(dname,db_source) VALUES('人事部',DATABASE());</div><div>INSERT INTO dept(dname,db_source) VALUES('财务部',DATABASE());</div><div>INSERT INTO dept(dname,db_source) VALUES('市场部',DATABASE());</div><div>INSERT INTO dept(dname,db_source) VALUES('运维部',DATABASE());</div></div><div><br/></div><h3>dao接口</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@Mapper</div><div>public interface DeptDao {</div><div>        public boolean addDept(Dept dept);</div><div>        public Dept findById(Long id);</div><div>        public List&lt;Dept&gt; findAll();</div><div>}</div></div><div><br/></div><h3>DeptMapper.xml</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</div><div>&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;mapper namespace=&quot;com.luo.springcloud.dao.DeptDao&quot;&gt;</div><div>        &lt;select id=&quot;findById&quot; resultType=&quot;Dept&quot; parameterType=&quot;Long&quot;&gt;</div><div>                select deptno,dname,db_source from dept where deptno=#{deptno};</div><div>        &lt;/select&gt;</div><div>        &lt;select id=&quot;findAll&quot; resultType=&quot;Dept&quot;&gt;</div><div>                select deptno,dname,db_source from dept;</div><div>        &lt;/select&gt;</div><div>        &lt;insert id=&quot;addDept&quot; parameterType=&quot;Dept&quot;&gt;</div><div>                INSERT INTO dept(dname,db_source) VALUES(#{dname},DATABASE());</div><div>        &lt;/insert&gt;</div><div>&lt;/mapper&gt;</div></div><h3>DeptService</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>public interface DeptService {</div><div>        public boolean add(Dept dept);</div><div>        public Dept get(Long id);</div><div>        public List&lt;Dept&gt; list();</div><div>}</div></div><div><br/></div><h3>DeptServiceImpl</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@Service</div><div>public class DeptServiceImpl implements DeptService{</div><div>        @Autowired</div><div>        private DeptDao dao;</div><div>        @Override</div><div>        public boolean add(Dept dept) {</div><div>                return dao.addDept(dept);</div><div>        }</div><div>        @Override</div><div>        public Dept get(Long id) {</div><div>                return dao.findById(id);</div><div>        }</div><div>        @Override</div><div>        public List&lt;Dept&gt; list() {</div><div>                return dao.findAll();</div><div>        }</div><div>}</div><div><br/></div><div><br/></div></div><div><br/></div><h3>DeptController</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@RestController</div><div>public class DeptController {</div><div>        @Autowired</div><div>        private DeptService service;</div><div>        </div><div>        @RequestMapping(value=&quot;/dept/add&quot;,method=RequestMethod.POST)</div><div>        public boolean add(@RequestBody Dept dept){</div><div>                return service.add(dept);</div><div>        }</div><div>        </div><div>        @RequestMapping(value=&quot;dept/get/{id}&quot;,method=RequestMethod.GET)</div><div>        public Dept get(@PathVariable(&quot;id&quot;) Long id){</div><div>                return service.get(id);</div><div>        }</div><div>        </div><div>        @RequestMapping(value=&quot;dept/list&quot;,method=RequestMethod.GET)</div><div>        public List&lt;Dept&gt; list(){</div><div>                return service.list();</div><div>        }</div><div>}</div></div><div><br/></div><h3>创建主启动类DeptProvider8001_App</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@SpringBootApplication</div><div>public class DeptProvider8001_App {</div><div>        public static void main(String[] args) {</div><div>                SpringApplication.run(DeptProvider8001_App.class, args);</div><div>        }</div><div>}</div><div><br/></div><div><br/></div></div><div><br/></div><h3>测试结果</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">输入<a href="http://localhost:8001/dept/list">http://localhost:8001/dept/list</a>以JSON的方式返回数据</span></div><h2>4.部门微服务消费者</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">首先现在父类项目上new一个maven module,microservicecloud-consumer-dept-80修改pom.xml文件</span></div><h3>POM.xml文件</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div>        xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div>        &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div>        &lt;parent&gt;</div><div>                &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>                &lt;artifactId&gt;microservicecloud&lt;/artifactId&gt;</div><div>                &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</div><div>        &lt;/parent&gt;</div><div>        &lt;artifactId&gt;microservicecloud-consumer-dept-80&lt;/artifactId&gt;</div><div>        &lt;description&gt;部门微服务消费者&lt;/description&gt;</div><div>        &lt;dependencies&gt;</div><div>                &lt;dependency&gt;&lt;!-- 自己定义的api --&gt;</div><div>                        &lt;groupId&gt;com.luo.springcloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;microservicecloud-api&lt;/artifactId&gt;</div><div>                        &lt;version&gt;${project.version}&lt;/version&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- Ribbon相关 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-ribbon&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;!-- 修改后立即生效，热部署 --&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>                &lt;dependency&gt;</div><div>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>                        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div>                &lt;/dependency&gt;</div><div>        &lt;/dependencies&gt;</div><div>&lt;/project&gt;</div></div><h3>application.yml文件</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:  port: 80</div></div><h3>ConfigBean注解类</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@Configuration</div><div>public class ConfigBean {</div><div>    @Bean</div><div>        public RestTemplate geRestTemplate(){</div><div>                return new RestTemplate();</div><div>        }</div><div>}</div></div><div><br/></div><h4>RestTemplate</h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">RestTemplate提供了多种便捷访问远程Http服务的方法，是一种简单高效便捷的访问restful服务模板类，是Spring提供的用于访问Rest服务的客户端模板工具类集，使用方法如下</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">（url,requestMap,ResponseBean.class）三个参数分别代表Rest请求地址，请求参数，HTTP响应转换被转换的对象类型</span></div><h3>DeptController_Consumer</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@RestController</div><div>public class DeptController_Consumer {</div><div>        private static final String REST_URL_PREFIX = &quot;http://localhost:8001&quot;;</div><div>        @Autowired</div><div>        private RestTemplate restTemplate;</div><div>        </div><div>        @RequestMapping(value=&quot;/consumer/dept/add&quot;)</div><div>        public boolean add(Dept dept){</div><div>                return restTemplate.postForObject(REST_URL_PREFIX+&quot;/dept/add&quot;, dept, Boolean.class);</div><div>        }</div><div>        </div><div>        @RequestMapping(value=&quot;/consumer/dept/get/{id}&quot;)</div><div>        public Dept get(@PathVariable(&quot;id&quot;) Long id){</div><div>                return restTemplate.getForObject(REST_URL_PREFIX+&quot;/dept/get/&quot;+id, Dept.class);</div><div>        }</div><div>        </div><div>        @RequestMapping(value=&quot;/consumer/dept/list&quot;)</div><div>        public Dept list(){</div><div>                return restTemplate.getForObject(REST_URL_PREFIX+&quot;/dept/list/&quot;, Dept.class);</div><div>        }</div><div>}</div></div><div><br/></div><h3>DeptConsumer80_App主类</h3><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@SpringBootApplication</div><div>public class DeptConsumer80_App {</div><div>        public static void main(String[] args) {</div><div>                SpringApplication.run(DeptConsumer80_App.class, args);</div><div>        }</div><div>}</div><div><br/></div><div><br/></div></div><div><br/></div><h3>测试结果</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"><a href="http://localhost/consumer/dept/list">http://localhost/consumer/dept/list</a></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"><a href="http://localhost/consumer/dept/get/2">http://localhost/consumer/dept/get/2</a></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"><a href="http://localhost/consumer/dept/add?dname=AI">http://localhost/consumer/dept/add?dname=AI</a></span></div></div></span>
</div></body></html> 